let f="user";var t=document.createElement("div");t.id="myDiv";t.style.position="fixed";t.style.top="2%";t.style.left="51%";t.style.zIndex=1e3;t.style.display="flex";t.style.flexDirection="row";t.style.gap="5px";const a=document.createElement("button");a.id="dgCopyAsMarkDown";let C="Copy as MarkDown";a.textContent=C;a.style.borderWidth="thin";a.style.borderRadius="5px";a.style.padding="2px 20px";a.addEventListener("click",w(!1));t.appendChild(a);const r=document.createElement("button");r.id="dgCopyAsText";let b="Copy as Text";r.textContent=b;r.style.borderWidth="thin";r.style.borderRadius="5px";r.style.padding="2px 20px";r.addEventListener("click",w(!0));t.appendChild(r);document.body.appendChild(t);const k=async()=>{const e=document.querySelector("textarea");e.value="",e.focus(),document.execCommand("paste");const o=e.value.trim();return e.value?(e.value="",o):""};class T{constructor(o,n,c,i,u=""){this.seq=o,this.author=n,this.plainText=c,this.copyBtn=i,this.markDown=u}}function h(e,o,n=!1){e?r.textContent=o:a.textContent=o,n&&setTimeout(()=>{e?r.textContent=b:a.textContent=C},2e3)}function w(e=!1){return()=>{h(e,"Copying...");const o="M12 4C10.8954 4 10 4.89543 10 6H14C14",n=[];document.querySelectorAll("[data-testid]").forEach(s=>{let p="data-message-author-role";const l=s.querySelector(`[${p}]`);let d=null,y=s.querySelectorAll("button");for(const x of y)if(l&&!l.contains(x)&&x.innerHTML.includes(o)){d=x;break}if(d||console.log("No copy button found"),!l)return;const v=new T(n.length,l.getAttribute(p),l.innerText.trim(),d);n.push(v)}),console.log("total message nodes",n.length);const i=n[Symbol.iterator](),u=[];let m=!1;const g=async s=>{if(!s){console.log("All Done!"),console.log(u),h(e,"Done!",!0),D(u,e);return}if(e||s.author===f)u.push(s);else{m=!0;for(let p=0;p<3;p++){s.copyBtn.click();const l=await k(),d=s.plainText.split(" ").slice(0,2).join(" ");if(l.startsWith(d)){s.markDown=l,u.push(s);break}else console.log("Retrying..."),console.log(d),console.log(l),await new Promise(y=>{setTimeout(()=>{y()},200)})}m=!1}setTimeout(()=>{m||g(i.next().value)},100)};g(i.next().value)}}function D(e,o){const n=e.map(c=>{let i=`${c.author===f?"User":"Assistant"}:
`;return o||c.author===f?i+=c.plainText+`
`:i+=c.markDown+`
`,i}).join(`

`);navigator.clipboard.writeText(n)}
